<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–¢—Ä–µ–∫–µ—Ä –Ω–∞–≤—ã–∫–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #2481cc;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f1f1f1;
            
            --primary: var(--tg-theme-text-color);
            --secondary: var(--tg-theme-hint-color);
            --background: var(--tg-theme-bg-color);
            --surface: var(--tg-theme-bg-color);
            --border: #e8e8ed;
            --hover: var(--tg-theme-secondary-bg-color);
            --accent: var(--tg-theme-button-color);
            --accent-hover: #1e6ba8;
            --accent-light: rgba(36, 129, 204, 0.1);
            --success: #34c759;
            --success-light: #d1f2d9;
            --success-glow: #22c55e;
            --muted: #e3e3e6;
            --danger: #ff3b30;
            --radius: 8px;
            --shadow: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-hover: 0 4px 16px rgba(0,0,0,0.08);
            --shadow-modal: 0 20px 40px rgba(0,0,0,0.15);
            --row-even: rgba(0,0,0,0.02);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            color: var(--primary);
            background: var(--background);
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            width: 100%;
            min-height: 100vh;
            background: var(--surface);
        }
        
        .toolbar {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .toolbar-separator {
            width: 1px;
            height: 20px;
            background: var(--border);
            margin: 0 4px;
        }
        
        button {
            padding: 8px 14px;
            border: none;
            background: var(--hover);
            color: var(--primary);
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button.primary {
            background: var(--accent);
            color: var(--tg-theme-button-text-color);
        }
        
        button.primary:active {
            background: var(--accent-hover);
        }
        
        button.danger {
            background: rgba(255,59,48,0.1);
            color: var(--danger);
        }
        
        .date-input {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            width: 100%;
        }
        
        .date-input label {
            font-size: 13px;
            color: var(--secondary);
            font-weight: 500;
            flex-shrink: 0;
        }
        
        .date-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            background: var(--surface);
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            color: var(--primary);
        }
        
        .table-wrapper {
            overflow: auto;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            min-width: 800px;
        }
        
        th, td {
            border: none;
            border-right: 1px solid var(--border);
            text-align: center;
            height: 44px;
            padding: 0;
        }
        
        tr td:last-child,
        tr th:last-child {
            border-right: none;
        }
        
        tbody tr:nth-child(even) {
            background-color: var(--row-even);
        }
        
        tbody tr {
            transition: background-color 0.2s ease;
        }
        
        th {
            background: var(--surface);
            font-weight: 600;
            font-size: 12px;
            color: var(--secondary);
            position: sticky;
            top: 0;
            z-index: 10;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
        }
        
        th.skill-header {
            width: 200px;
            text-align: left;
            padding: 0 16px;
            background: var(--surface);
            position: sticky;
            left: 0;
            z-index: 11;
            border-right: 2px solid var(--border);
            color: var(--accent);
        }
        
        .date-header {
            font-size: 11px;
            line-height: 1.3;
            padding: 4px;
            min-width: 44px;
        }
        
        td.skill-cell {
            text-align: left;
            padding: 0 16px;
            background: inherit;
            position: sticky;
            left: 0;
            z-index: 9;
            border-right: 2px solid var(--border);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            height: 44px;
        }
        
        .skill-number {
            flex-shrink: 0;
            color: var(--secondary);
            font-weight: 500;
            font-size: 13px;
        }
        
        .skill-name-text {
            flex: 1;
            line-height: 1.3;
            font-size: 13px;
        }
        
        tbody tr:nth-child(even) td.skill-cell {
            background: var(--row-even);
        }
        
        .day-cell {
            cursor: pointer;
            position: relative;
            transition: all 0.15s ease;
            width: 44px;
            min-width: 44px;
        }
        
        .day-cell:active {
            background: var(--accent-light) !important;
        }
        
        .day-cell.checked {
            background: var(--success-light) !important;
        }
        
        .day-cell.checked .score {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .day-cell.score-0,
        .day-cell.score-1,
        .day-cell.score-2,
        .day-cell.score-3,
        .day-cell.score-4 {
            background: var(--muted) !important;
        }
        
        .day-cell.score-5,
        .day-cell.score-6,
        .day-cell.score-7 {
            background: var(--success-light) !important;
        }
        
        .day-cell.score-7 {
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(34,197,94,0.4); 
            }
            50% { 
                box-shadow: 0 0 20px rgba(34,197,94,0.6); 
            }
        }
        
        .weekend {
            background-color: rgba(36,129,204,0.03) !important;
        }
        
        tbody tr:nth-child(even) .weekend {
            background-color: rgba(36,129,204,0.05) !important;
        }
        
        th.current-day {
            background: linear-gradient(180deg, var(--accent) 3px, var(--surface) 3px) !important;
            box-shadow: inset 0 2px 0 var(--accent);
        }
        
        .comment-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 5px;
            height: 5px;
            background: var(--accent);
            border-radius: 50%;
        }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .modal-content {
            background: var(--surface);
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            border-radius: 12px;
            box-shadow: var(--shadow-modal);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h2 {
            font-size: 17px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-footer {
            padding: 12px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .close-button {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            padding: 0;
            font-size: 20px;
            color: var(--secondary);
            transition: all 0.2s ease;
        }
        
        .close-button:active {
            background: var(--hover);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--secondary);
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--surface);
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            color: var(--primary);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .score-selector {
            display: none;
            position: absolute;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            z-index: 100;
            overflow: hidden;
        }
        
        .score-option {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid var(--hover);
            transition: background 0.2s ease;
        }
        
        .score-option:last-child {
            border-bottom: none;
        }
        
        .score-option:active {
            background: var(--hover);
        }
        
        .skill-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        .skill-item {
            padding: 14px 16px;
            border-bottom: 1px solid var(--hover);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }
        
        .skill-item:last-child {
            border-bottom: none;
        }
        
        .skill-info {
            flex: 1;
            min-width: 0;
        }
        
        .skill-name {
            font-weight: 500;
            margin-bottom: 2px;
            word-break: break-word;
        }
        
        .skill-category {
            font-size: 12px;
            color: var(--secondary);
            opacity: 0.8;
        }
        
        .skill-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .skill-actions button {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        
        .stat-card {
            padding: 16px;
            background: var(--hover);
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .stat-card h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--primary);
        }
        
        .stat-card p {
            font-size: 13px;
            color: var(--secondary);
            margin-bottom: 3px;
        }
        
        .info-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .info-section {
            margin-bottom: 20px;
        }
        
        .info-section h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .score-list {
            font-size: 13px;
            line-height: 1.8;
        }
        
        .score-list strong {
            display: inline-block;
            width: 24px;
        }
        
        .comment-form {
            margin-top: 16px;
        }
        
        .comment-display {
            margin-top: 12px;
            padding: 10px;
            background: var(--hover);
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.5;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .tooltip {
            position: absolute;
            background: var(--primary);
            color: var(--surface);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 250px;
            word-break: break-word;
        }
        
        .tooltip.show {
            opacity: 0.95;
        }
        
        @media (max-width: 600px) {
            .toolbar {
                padding: 10px 12px;
            }
            
            button {
                padding: 7px 12px;
                font-size: 12px;
            }
            
            .date-input {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .date-input input {
                width: 100%;
            }
            
            th.skill-header {
                width: 150px;
                padding: 0 12px;
            }
            
            td.skill-cell {
                padding: 0 12px;
            }
            
            .modal-content {
                max-height: 90vh;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Dark theme support */
        @media (prefers-color-scheme: dark) {
            :root {
                --row-even: rgba(255,255,255,0.02);
                --border: rgba(255,255,255,0.1);
                --hover: rgba(255,255,255,0.05);
            }
        }
        
        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-size: 16px;
            color: var(--secondary);
        }
        
        /* Privacy notice */
        .privacy-notice {
            padding: 12px 16px;
            background: var(--accent-light);
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            color: var(--secondary);
            text-align: center;
        }
        
        .privacy-notice a {
            color: var(--accent);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="privacy-notice" id="privacyNotice" style="display: none;">
            –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
        </div>
        
        <div class="toolbar">
            <div class="toolbar-group">
                <button onclick="showSkillManager()">–ù–∞–≤—ã–∫–∏</button>
                <button onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <button onclick="document.getElementById('importFile').click()">–ò–º–ø–æ—Ä—Ç</button>
                <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
            </div>
            
            <div class="toolbar-separator"></div>
            
            <div class="toolbar-group">
                <button onclick="showInstructions()">–°–ø—Ä–∞–≤–∫–∞</button>
                <button onclick="showStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>
            
            <div class="date-input">
                <label>–ù–∞—á–∞–ª–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:</label>
                <input type="date" id="startDate" onchange="updateDates()">
            </div>
        </div>
        
        <div class="table-wrapper">
            <table id="skillsTable">
                <thead>
                    <tr>
                        <th class="skill-header">–ù–∞–≤—ã–∫</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <button class="close-button" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>
    
    <div id="scoreSelector" class="score-selector"></div>
    <div id="tooltip" class="tooltip"></div>
    
    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // Apply Telegram theme colors
        if (tg.themeParams) {
            const root = document.documentElement;
            const params = tg.themeParams;
            
            if (params.bg_color) root.style.setProperty('--tg-theme-bg-color', params.bg_color);
            if (params.text_color) root.style.setProperty('--tg-theme-text-color', params.text_color);
            if (params.hint_color) root.style.setProperty('--tg-theme-hint-color', params.hint_color);
            if (params.link_color) root.style.setProperty('--tg-theme-link-color', params.link_color);
            if (params.button_color) root.style.setProperty('--tg-theme-button-color', params.button_color);
            if (params.button_text_color) root.style.setProperty('--tg-theme-button-text-color', params.button_text_color);
            if (params.secondary_bg_color) root.style.setProperty('--tg-theme-secondary-bg-color', params.secondary_bg_color);
        }
        
        // Storage key prefix with user ID for privacy
        const userId = tg.initDataUnsafe?.user?.id || 'anonymous';
        const storagePrefix = `tg_skills_${userId}_`;
        
        // Default skills
        let skills = [
            {
                id: 1,
                name: "–ù–µ –ø–æ–¥–¥–∞–≤–∞—Ç—å—Å—è –∏–º–ø—É–ª—å—Å–∞–º",
                category: "–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º–ø—É–ª—å—Å–æ–≤",
                description: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–æ–∑–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –æ—Ç –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π",
                instruction: ""
            },
            {
                id: 2,
                name: "–ú—ã—à–µ—á–Ω–∞—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è",
                category: "–§–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è",
                description: "–¢–µ—Ö–Ω–∏–∫–∞ –î–∂–µ–π–∫–æ–±—Å–æ–Ω–∞: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –º—ã—à—Ü",
                instruction: "–°–∂–∞—Ç—å-—Ä–∞—Å—Å–ª–∞–±–∏—Ç—å –≥—Ä—É–ø–ø—ã –º—ã—à—Ü —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ (2 –º–∏–Ω—É—Ç—ã)"
            },
            {
                id: 3,
                name: "–í–æ–ø—Ä–æ—Å ¬´–ú–Ω–µ —ç—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ?¬ª",
                category: "–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å",
                description: "–û—Ü–µ–Ω–∫–∞ –ø–æ–ª—å–∑—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏–ª–∏ –º—ã—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏",
                instruction: "–ó–∞–¥–∞–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –ø–∞—É–∑—ã, –∫–æ–≥–¥–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å ‚â§ 6 –∏–∑ 10"
            },
            {
                id: 4,
                name: "–ü–†–û–°–ò-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è",
                category: "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è",
                description: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –º–µ–∂–ª–∏—á–Ω–æ—Å—Ç–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è",
                instruction: "5 —à–∞–≥–æ–≤: –ü—Ä–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Ñ–∞–∫—Ç—ã ‚Üí –†–∞—Å–∫—Ä—ã—Ç—å —á—É–≤—Å—Ç–≤–∞ ‚Üí –û—Ç—Å—Ç–æ—è—Ç—å –ø–æ–∑–∏—Ü–∏—é ‚Üí –°–æ–æ–±—â–∏—Ç—å –≤—ã–≥–æ–¥—É ‚Üí –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–∏—à–Ω–µ–µ"
            },
            {
                id: 5,
                name: "–°–¢–û–ü-–ø–∞—É–∑–∞",
                category: "–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º–ø—É–ª—å—Å–æ–≤",
                description: "–¢–µ—Ö–Ω–∏–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏ –≤—Å–ø–ª–µ—Å–∫–µ —ç–º–æ—Ü–∏–π",
                instruction: "–°—Ç–æ–ø ‚Üí –®–∞–≥ –Ω–∞–∑–∞–¥ ‚Üí –ù–∞–±–ª—é–¥–∞–π ‚Üí –î–µ–π—Å—Ç–≤—É–π –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –≤–¥–æ—Ö, —Å–∫–∞–∑–∞—Ç—å ¬´—Å—Ç–æ–ø¬ª, –∑–∞–º–µ—Ä–µ—Ç—å –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã"
            },
            {
                id: 6,
                name: "–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è",
                category: "–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å",
                description: "–§–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç–∏–º—É–ª–∞—Ö",
                instruction: "–Ø–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ –∑–≤—É–∫/–¥—ã—Ö–∞–Ω–∏–µ –≤–µ—Ç—Ä–∞"
            },
            {
                id: 7,
                name: "–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Ö–æ–ª–æ–¥ –∫ –ª–∏—Ü—É",
                category: "–§–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è",
                description: "–ë—ã—Å—Ç—Ä–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è",
                instruction: "–£–º—ã—Ç—å –ª–∏—Ü–æ —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–¥–æ–π 10 —Å–µ–∫—É–Ω–¥. –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏ > 7/10"
            },
            {
                id: 8,
                name: "–ë–µ–∑–æ—Ü–µ–Ω–æ—á–Ω–æ—Å—Ç—å",
                category: "–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å",
                description: "–ü—Ä–∏–Ω—è—Ç–∏–µ –º—ã—Å–ª–µ–π –±–µ–∑ –æ—Ü–µ–Ω–∫–∏ –∫–∞–∫ —Ñ–∞–∫—Ç–æ–≤",
                instruction: "–ü–æ–π–º–∞—Ç—å ¬´—è—Ä–ª—ã–∫¬ª, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ ¬´—è –¥—É–º–∞—é, —á—Ç–æ‚Ä¶¬ª. –ü–æ–º–Ω–∏—Ç—å: –º—ã—Å–ª—å ‚â† —Ñ–∞–∫—Ç"
            },
            {
                id: 9,
                name: "–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è —Å–ª–æ–≤–∞–º–∏",
                category: "–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å",
                description: "–í–µ—Ä–±–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π",
                instruction: "–ü—Ä–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å: ¬´–≠—Ç–æ —Å—Ç—Ä–∞—Ö‚Ä¶ —ç—Ç–æ –∫—Ä–∏—Ç–∏–∫‚Ä¶¬ª"
            },
            {
                id: 10,
                name: "–ë–ª–∞–Ω–∫ ¬´–ó–∞ –∏ –ø—Ä–æ—Ç–∏–≤¬ª",
                category: "–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π",
                description: "–°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π",
                instruction: "4 —Å—Ç–æ–ª–±—Ü–∞, –≤—ã–±—Ä–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ —Å ‚â•2 –ø–ª—é—Å–∞–º–∏ –∏ ‚â§1 –∫—Ä–∏—Ç–∏—á–Ω—ã–º –º–∏–Ω—É—Å–æ–º"
            },
            {
                id: 11,
                name: "–í—ã–ø–∏—Å—ã–≤–∞—Ç—å –º—ã—Å–ª–∏",
                category: "–†–∞–±–æ—Ç–∞ —Å –º—ã—Å–ª—è–º–∏",
                description: "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –º—ã—Å–ª–µ–π",
                instruction: "10-–º–∏–Ω—É—Ç–Ω—ã–π –ø–æ—Ç–æ–∫, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞—è —Ñ–∞–∫—Ç—ã/–¥–æ–º—ã—Å–ª—ã"
            },
            {
                id: 12,
                name: "–ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏",
                category: "–ü—Ä–∏–Ω—è—Ç–∏–µ –∏ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ",
                description: "–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏ –±–µ–∑ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è",
                instruction: "–í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–æ –Ω–∞ ¬´–æ–±–ª–∞–∫–µ¬ª, –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, –∫–∞–∫ –æ–Ω–æ –ø—Ä–æ–ø–ª—ã–≤–∞–µ—Ç. –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∏ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –≤–æ–ª–Ω–µ–Ω–∏–∏ 3-5/10"
            },
            {
                id: 13,
                name: "–ù–∞–≤—ã–∫ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è",
                category: "–ü—Ä–∏–Ω—è—Ç–∏–µ –∏ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ",
                description: "–ü—Ä–æ—è–≤–ª–µ–Ω–∏–µ –¥–æ–±—Ä–æ—Ç—ã –∫ —Å–µ–±–µ",
                instruction: "–ü–æ–ª–æ–∂–∏—Ç—å –ª–∞–¥–æ–Ω—å –Ω–∞ –≥—Ä—É–¥—å, —Å–¥–µ–ª–∞—Ç—å ¬´–ø–æ–ª-—É–ª—ã–±–∫–∏¬ª, —Å–∫–∞–∑–∞—Ç—å ¬´—è –º–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –ø—ã—Ç–∞—é—Å—å¬ª. –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏/–∫—Ä–∏—Ç–∏–∫–∏"
            }
        ];
        
        const scoreDescriptions = [
            "–ù–µ –¥—É–º–∞–ª(–∞) –æ –Ω–∞–≤—ã–∫–µ",
            "–î—É–º–∞–ª(–∞), –Ω–µ —Ö–æ—Ç–µ–ª(–∞) –ø—Ä–∏–º–µ–Ω—è—Ç—å",
            "–•–æ—Ç–µ–ª(–∞), –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª(–∞)",
            "–°—Ç–∞—Ä–∞–ª—Å—è(–∞—Å—å), –Ω–µ —Å–º–æ–≥(–ª–∞)",
            "–ü—Ä–∏–º–µ–Ω–∏–ª(–∞), –Ω–µ –ø–æ–º–æ–≥–ª–æ",
            "–ü—Ä–∏–º–µ–Ω–∏–ª(–∞), –ø–æ–º–æ–≥–ª–æ",
            "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–µ –ø–æ–º–æ–≥–ª–æ",
            "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ–º–æ–≥–ª–æ"
        ];
        
        let data = loadData();
        let comments = loadComments();
        let startDate = localStorage.getItem(storagePrefix + 'startDate') || new Date().toISOString().split('T')[0];
        
        let longPressTimer;
        let isLongPress = false;
        
        function loadData() {
            const saved = localStorage.getItem(storagePrefix + 'data');
            const savedSkills = localStorage.getItem(storagePrefix + 'skills');
            
            if (savedSkills) {
                skills = JSON.parse(savedSkills);
            }
            
            return saved ? JSON.parse(saved) : {};
        }
        
        function loadComments() {
            const saved = localStorage.getItem(storagePrefix + 'comments');
            return saved ? JSON.parse(saved) : {};
        }
        
        function saveData() {
            localStorage.setItem(storagePrefix + 'data', JSON.stringify(data));
            localStorage.setItem(storagePrefix + 'skills', JSON.stringify(skills));
            localStorage.setItem(storagePrefix + 'startDate', startDate);
            localStorage.setItem(storagePrefix + 'comments', JSON.stringify(comments));
            
            // Trigger Telegram haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        function initTable() {
            document.getElementById('startDate').value = startDate;
            updateDates();
            
            // Show privacy notice briefly
            const privacyNotice = document.getElementById('privacyNotice');
            privacyNotice.style.display = 'block';
            setTimeout(() => {
                privacyNotice.style.display = 'none';
            }, 3000);
        }
        
        function updateDates() {
            startDate = document.getElementById('startDate').value;
            saveData();
            
            const table = document.getElementById('skillsTable');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');
            
            while (thead.children.length > 1) {
                thead.removeChild(thead.lastChild);
            }
            
            tbody.innerHTML = '';
            
            const start = new Date(startDate);
            start.setHours(0, 0, 0, 0);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(start);
                date.setDate(start.getDate() + i);
                date.setHours(0, 0, 0, 0);
                
                const th = document.createElement('th');
                th.className = 'date-header';
                
                const dayOfWeek = date.getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    th.classList.add('weekend');
                }
                
                if (date.toDateString() === today.toDateString()) {
                    th.classList.add('current-day');
                }
                
                th.innerHTML = `${date.getDate()}<br>${date.toLocaleDateString('ru', {month: 'short'})}`;
                thead.appendChild(th);
            }
            
            skills.forEach((skill, index) => {
                const tr = document.createElement('tr');
                
                const skillCell = document.createElement('td');
                skillCell.className = 'skill-cell';
                skillCell.innerHTML = `<span class="skill-number">${index + 1}.</span><span class="skill-name-text">${skill.name}</span>`;
                skillCell.title = skill.category;
                skillCell.onclick = () => showSkillDetails(skill);
                tr.appendChild(skillCell);
                
                for (let day = 0; day < 30; day++) {
                    const date = new Date(start);
                    date.setDate(start.getDate() + day);
                    const dayOfWeek = date.getDay();
                    
                    const td = document.createElement('td');
                    td.className = 'day-cell';
                    
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        td.classList.add('weekend');
                    }
                    
                    td.dataset.skillId = skill.id;
                    td.dataset.day = day;
                    
                    const key = `${skill.id}-${day}`;
                    const commentKey = `comment-${skill.id}-${day}`;
                    
                    if (data[key] !== undefined) {
                        td.classList.add('checked');
                        if (typeof data[key] === 'number') {
                            td.classList.add(`score-${data[key]}`);
                            td.innerHTML = `<div class="score">${data[key]}</div>`;
                        }
                        
                        if (comments[commentKey]) {
                            const indicator = document.createElement('div');
                            indicator.className = 'comment-indicator';
                            td.appendChild(indicator);
                        }
                    }
                    
                    // Touch event handlers for mobile
                    td.addEventListener('touchstart', (e) => {
                        isLongPress = false;
                        longPressTimer = setTimeout(() => {
                            isLongPress = true;
                            showScoreSelector(e.touches[0], skill.id, day);
                            if (tg.HapticFeedback) {
                                tg.HapticFeedback.impactOccurred('medium');
                            }
                        }, 500);
                    });
                    
                    td.addEventListener('touchend', (e) => {
                        clearTimeout(longPressTimer);
                        if (!isLongPress) {
                            e.preventDefault();
                            toggleCell(e, skill.id, day);
                        }
                    });
                    
                    td.addEventListener('touchmove', () => {
                        clearTimeout(longPressTimer);
                    });
                    
                    // Mouse events for desktop
                    td.onclick = (e) => {
                        if (!('ontouchstart' in window)) {
                            toggleCell(e, skill.id, day);
                        }
                    };
                    
                    td.oncontextmenu = (e) => {
                        e.preventDefault();
                        if (!('ontouchstart' in window)) {
                            showScoreSelector(e, skill.id, day);
                        }
                    };
                    
                    td.onmouseenter = (e) => {
                        if (!('ontouchstart' in window)) {
                            showTooltip(e, skill.id, day);
                        }
                    };
                    
                    td.onmouseleave = () => {
                        if (!('ontouchstart' in window)) {
                            hideTooltip();
                        }
                    };
                    
                    tr.appendChild(td);
                }
                
                tbody.appendChild(tr);
            });
        }
        
        function toggleCell(e, skillId, day) {
            const cell = e.target.closest('.day-cell');
            const key = `${skillId}-${day}`;
            
            if (data[key] !== undefined) {
                delete data[key];
                cell.classList.remove('checked');
                cell.classList.remove(...Array.from(cell.classList).filter(c => c.startsWith('score-')));
                cell.innerHTML = '';
            } else {
                data[key] = true;
                cell.classList.add('checked');
            }
            
            saveData();
        }
        
        function showScoreSelector(e, skillId, day) {
            const selector = document.getElementById('scoreSelector');
            selector.innerHTML = '';
            selector.style.display = 'block';
            
            const rect = document.body.getBoundingClientRect();
            const x = e.pageX || e.clientX;
            const y = e.pageY || e.clientY;
            
            selector.style.left = Math.min(x, window.innerWidth - 200) + 'px';
            selector.style.top = y + 'px';
            
            scoreDescriptions.forEach((desc, score) => {
                const option = document.createElement('div');
                option.className = 'score-option';
                option.textContent = `${score}: ${desc}`;
                option.onclick = () => setScore(skillId, day, score);
                selector.appendChild(option);
            });
            
            const commentOption = document.createElement('div');
            commentOption.className = 'score-option';
            commentOption.style.borderTop = '2px solid var(--border)';
            commentOption.innerHTML = '<strong>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...</strong>';
            commentOption.onclick = () => {
                closeScoreSelector();
                showCommentModal(skillId, day);
            };
            selector.appendChild(commentOption);
            
            setTimeout(() => {
                document.addEventListener('click', closeScoreSelector);
                document.addEventListener('touchstart', closeScoreSelector);
            }, 0);
        }
        
        function closeScoreSelector() {
            document.getElementById('scoreSelector').style.display = 'none';
            document.removeEventListener('click', closeScoreSelector);
            document.removeEventListener('touchstart', closeScoreSelector);
        }
        
        function setScore(skillId, day, score) {
            const key = `${skillId}-${day}`;
            const cell = document.querySelector(`[data-skill-id="${skillId}"][data-day="${day}"]`);
            
            data[key] = score;
            cell.classList.add('checked');
            cell.classList.remove(...Array.from(cell.classList).filter(c => c.startsWith('score-')));
            cell.classList.add(`score-${score}`);
            cell.innerHTML = `<div class="score">${score}</div>`;
            
            const commentKey = `comment-${skillId}-${day}`;
            if (comments[commentKey]) {
                const indicator = document.createElement('div');
                indicator.className = 'comment-indicator';
                cell.appendChild(indicator);
            }
            
            saveData();
            closeScoreSelector();
        }
        
        function showCommentModal(skillId, day) {
            const skill = skills.find(s => s.id === skillId);
            const commentKey = `comment-${skillId}-${day}`;
            const existingComment = comments[commentKey] || '';
            
            const content = `
                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞–≤—ã–∫–∞</label>
                    <textarea id="commentText" placeholder="–û–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –Ω–∞–≤—ã–∫...">${existingComment}</textarea>
                </div>
            `;
            
            const footer = `
                <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="primary" onclick="saveComment(${skillId}, ${day})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            const date = new Date(startDate);
            date.setDate(date.getDate() + day);
            showModal(`${skill.name} - ${date.toLocaleDateString('ru')}`, content, footer);
        }
        
        function saveComment(skillId, day) {
            const commentText = document.getElementById('commentText').value.trim();
            const commentKey = `comment-${skillId}-${day}`;
            
            if (commentText) {
                comments[commentKey] = commentText;
            } else {
                delete comments[commentKey];
            }
            
            saveData();
            closeModal();
            updateDates();
        }
        
        function showTooltip(e, skillId, day) {
            const commentKey = `comment-${skillId}-${day}`;
            if (comments[commentKey]) {
                const tooltip = document.getElementById('tooltip');
                tooltip.textContent = comments[commentKey];
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY + 10 + 'px';
                tooltip.classList.add('show');
            }
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('show');
        }
        
        function showModal(title, content, footer = '') {
            const modal = document.getElementById('modal');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modalFooter').innerHTML = footer;
            modal.style.display = 'flex';
            
            if (tg.BackButton) {
                tg.BackButton.show();
                tg.BackButton.onClick(closeModal);
            }
        }
        
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            
            if (tg.BackButton) {
                tg.BackButton.hide();
            }
        }
        
        function showSkillDetails(skill) {
            const content = `
                <div class="info-section">
                    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h3>
                    <p class="info-text">${skill.category}</p>
                </div>
                <div class="info-section">
                    <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p class="info-text">${skill.description}</p>
                </div>
                ${skill.instruction ? `
                <div class="info-section">
                    <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
                    <p class="info-text">${skill.instruction}</p>
                </div>
                ` : ''}
            `;
            showModal(skill.name, content);
        }
        
        function showSkillManager() {
            const content = `
                <button class="primary" onclick="showAddSkill()" style="margin-bottom: 16px; width: 100%;">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫</button>
                <div class="skill-list">
                    ${skills.map((skill, index) => `
                        <div class="skill-item">
                            <div class="skill-info">
                                <div class="skill-name">${index + 1}. ${skill.name}</div>
                                <div class="skill-category">${skill.category}</div>
                            </div>
                            <div class="skill-actions">
                                <button onclick="editSkill(${skill.id})">‚úèÔ∏è</button>
                                <button class="danger" onclick="deleteSkill(${skill.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            showModal('–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤—ã–∫–∞–º–∏', content);
        }
        
        function showAddSkill() {
            const content = `
                <form id="skillForm">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞</label>
                        <input type="text" id="skillName" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <input type="text" id="skillCategory" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="skillDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <textarea id="skillInstruction"></textarea>
                    </div>
                </form>
            `;
            
            const footer = `
                <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="primary" onclick="saveNewSkill()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫', content, footer);
        }
        
        function saveNewSkill() {
            const name = document.getElementById('skillName').value.trim();
            const category = document.getElementById('skillCategory').value.trim();
            const description = document.getElementById('skillDescription').value.trim();
            const instruction = document.getElementById('skillInstruction').value.trim();
            
            if (!name || !category || !description) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            const newSkill = {
                id: Date.now(),
                name,
                category,
                description,
                instruction
            };
            
            skills.push(newSkill);
            saveData();
            closeModal();
            updateDates();
        }
        
        function editSkill(id) {
            const skill = skills.find(s => s.id === id);
            if (!skill) return;
            
            const content = `
                <form id="skillForm">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–∞</label>
                        <input type="text" id="skillName" value="${skill.name}" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <input type="text" id="skillCategory" value="${skill.category}" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="skillDescription" required>${skill.description}</textarea>
                    </div>
                    <div class="form-group">
                        <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <textarea id="skillInstruction">${skill.instruction || ''}</textarea>
                    </div>
                </form>
            `;
            
            const footer = `
                <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="primary" onclick="updateSkill(${id})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            `;
            
            showModal('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫', content, footer);
        }
        
        function updateSkill(id) {
            const skill = skills.find(s => s.id === id);
            if (!skill) return;
            
            skill.name = document.getElementById('skillName').value.trim();
            skill.category = document.getElementById('skillCategory').value.trim();
            skill.description = document.getElementById('skillDescription').value.trim();
            skill.instruction = document.getElementById('skillInstruction').value.trim();
            
            if (!skill.name || !skill.category || !skill.description) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            saveData();
            closeModal();
            updateDates();
        }
        
        function deleteSkill(id) {
            tg.showConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –Ω–∞–≤—ã–∫? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –Ω–µ–º—É –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.', (confirmed) => {
                if (!confirmed) return;
                
                skills = skills.filter(s => s.id !== id);
                
                const newData = {};
                const newComments = {};
                for (let key in data) {
                    if (!key.startsWith(`${id}-`)) {
                        newData[key] = data[key];
                    }
                }
                for (let key in comments) {
                    if (!key.includes(`-${id}-`)) {
                        newComments[key] = comments[key];
                    }
                }
                data = newData;
                comments = newComments;
                
                saveData();
                closeModal();
                updateDates();
            });
        }
        
        function showInstructions() {
            const content = `
                <div class="info-section">
                    <h3>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                    <p class="info-text"><strong>–û—Ç–º–µ—Ç–∫–∞ –Ω–∞–≤—ã–∫–∞:</strong> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —è—á–µ–π–∫—É –¥–Ω—è.</p>
                    <p class="info-text"><strong>–û—Ü–µ–Ω–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ (–º–æ–±–∏–ª—å–Ω—ã–µ) –∏–ª–∏ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ (–ü–ö).</p>
                    <p class="info-text"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> –í—ã–±–µ—Ä–∏—Ç–µ –≤ –º–µ–Ω—é –æ—Ü–µ–Ω–æ–∫.</p>
                    <p class="info-text"><strong>–û –Ω–∞–≤—ã–∫–µ:</strong> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ.</p>
                </div>
                
                <div class="info-section">
                    <h3>–®–∫–∞–ª–∞ –æ—Ü–µ–Ω–æ–∫</h3>
                    <div class="score-list">
                        <div><strong>0-4</strong> ‚Äî —Å–µ—Ä—ã–π (–Ω–∞–≤—ã–∫ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç—ã)</div>
                        <div><strong>5-7</strong> ‚Äî –∑–µ–ª–µ–Ω—ã–π (–Ω–∞–≤—ã–∫ –ø–æ–º–æ–≥)</div>
                        <div><strong>7</strong> ‚Äî —Å–≤–µ—á–µ–Ω–∏–µ (–ø–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º)</div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</h3>
                    <p class="info-text">–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. Telegram –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º.</p>
                </div>
            `;
            showModal('–°–ø—Ä–∞–≤–∫–∞', content);
        }
        
        function showStats() {
            const stats = skills.map((skill, index) => {
                let uses = 0;
                let totalScore = 0;
                let scoreCount = 0;
                let automaticUses = 0;
                const dailyScores = [];
                
                for (let day = 0; day < 30; day++) {
                    const key = `${skill.id}-${day}`;
                    if (data[key] !== undefined) {
                        uses++;
                        if (typeof data[key] === 'number') {
                            totalScore += data[key];
                            scoreCount++;
                            dailyScores.push(data[key]);
                            if (data[key] >= 6) {
                                automaticUses++;
                            }
                        }
                    }
                }
                
                return {
                    number: index + 1,
                    name: skill.name,
                    category: skill.category,
                    uses,
                    avgScore: scoreCount > 0 ? (totalScore / scoreCount).toFixed(1) : '-',
                    automaticUses,
                    trend: dailyScores.length > 1 ? 
                        (dailyScores[dailyScores.length - 1] > dailyScores[0] ? '‚Üë' : '‚Üí') : ''
                };
            });
            
            stats.sort((a, b) => b.uses - a.uses);
            
            const content = `
                <div class="stats-grid">
                    ${stats.map(stat => `
                        <div class="stat-card">
                            <h4>${stat.number}. ${stat.name}</h4>
                            <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${stat.category}</p>
                            <p>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω: ${stat.uses} —Ä–∞–∑</p>
                            ${stat.avgScore !== '-' ? `<p>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: ${stat.avgScore} ${stat.trend}</p>` : ''}
                            ${stat.automaticUses > 0 ? `<p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: ${stat.automaticUses} —Ä–∞–∑</p>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            showModal('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', content);
        }
        
        function exportData() {
            const exportObj = {
                skills: skills,
                data: data,
                comments: comments,
                startDate: startDate,
                exportDate: new Date().toISOString(),
                version: '2.1'
            };
            
            const dataStr = JSON.stringify(exportObj, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `skills-tracker-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            tg.showAlert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
        }
        
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    tg.showConfirm('–≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?', (confirmed) => {
                        if (!confirmed) return;
                        
                        if (importedData.skills) skills = importedData.skills;
                        if (importedData.data) data = importedData.data;
                        if (importedData.comments) comments = importedData.comments;
                        if (importedData.startDate) startDate = importedData.startDate;
                        
                        saveData();
                        location.reload();
                    });
                } catch (error) {
                    tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');
                }
            };
            reader.readAsText(file);
        }
        
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // Initialize
        initTable();
        
        // Handle Telegram theme changes
        tg.onEvent('themeChanged', () => {
            location.reload();
        });
    </script>
</body>
</html>